# Exercise 1: MCP Gateway Setup and Basic Tool Integration

**Duration:** 15 minutes  
**Objective:** Set up MCP Gateway and create your first agent with external tool capabilities

## Overview

In this exercise, you'll set up the MCP Gateway service and create an AI agent that can use external tools for web search. You'll start with the enhanced agent-docker-v7 example and understand how MCP Gateway provides secure access to external APIs.

## Prerequisites

- Completed Module 2 exercises
- Docker and Docker Compose installed
- Basic understanding of Docker services

## Step 1: Examine the Enhanced Agent Example

First, let's look at the enhanced agent-docker-v7 example that demonstrates MCP Gateway integration:

```bash
# Navigate to the enhanced agent example
cd agents-on-docker/agent-docker-v7

# Examine the agent code
cat agent.py
```

**Key components to notice:**
- MCP client initialization with SSE transport
- Tool discovery from MCP Gateway
- Combination of MCP tools with custom tools
- Proper error handling and resource management

## Step 2: Understand the Docker Compose Configuration

Examine the Docker Compose configuration that sets up both the agent and MCP Gateway:

```bash
# View the compose configuration
cat compose.yaml
```

**Key configuration elements:**
- `mcp-gateway` service with DuckDuckGo search server
- Agent service with MCP Gateway dependency
- Environment variables for MCP connection
- Volume mounts for persistent data

## Step 3: Start the MCP Gateway and Agent

Let's start the services and see MCP Gateway in action:

```bash
# Build and start all services
docker compose up --build

# In another terminal, watch the logs
docker compose logs -f
```

**Expected behavior:**
- MCP Gateway starts and initializes DuckDuckGo server
- Agent connects to MCP Gateway
- Agent discovers available tools (search)
- Agent processes the default question using search tool
- Definition is saved to the definitions directory

## Step 4: Verify MCP Gateway Health

Test that MCP Gateway is running correctly:

```bash
# Check MCP Gateway health endpoint
curl http://localhost:8811/health

# Expected response: {"status": "healthy"}
```

## Step 5: Examine the Results

Check the output generated by the agent:

```bash
# List generated definition files
ls -la definitions/

# View the generated definition
cat definitions/Entropy.txt
```

**What you should see:**
- A well-formatted definition file
- Content that was researched using the search tool
- Proper file naming and structure

## Step 6: Test with Different Questions

Modify the research question and see how the agent responds:

```bash
# Stop the current services
docker compose down

# Start with a different question
QUESTION="What is quantum computing?" docker compose up --build
```

**Observe:**
- How the agent uses the search tool to research the new topic
- The quality and accuracy of the generated definition
- The file naming based on the search term

## Step 7: Inspect MCP Tool Discovery

Let's examine what tools are available from MCP Gateway:

```bash
# Connect to the running agent container
docker compose exec agent python3 -c "
from mcp.client.sse import sse_client
from strands.tools.mcp import MCPClient
import os

print('üîç Discovering MCP tools...')
mcp_client = MCPClient(lambda: sse_client(os.getenv('MCP_SERVER_URL')))
with mcp_client:
    tools = mcp_client.list_tools_sync()
    print(f'üìã Found {len(tools)} MCP tools:')
    for tool in tools:
        print(f'  - {tool.name}: {tool.description}')
"
```

**Expected output:**
- List of available tools from DuckDuckGo server
- Tool descriptions and capabilities
- Confirmation that MCP Gateway is working correctly

## Validation Checkpoint

‚úÖ **Verify your setup is working correctly:**

1. **MCP Gateway Health**: `curl http://localhost:8811/health` returns `{"status": "healthy"}`
2. **Agent Execution**: Agent successfully processes questions and saves definitions
3. **Tool Discovery**: MCP tools are discovered and available to the agent
4. **File Output**: Definition files are created in the `definitions/` directory
5. **Search Functionality**: Agent can successfully search for information using MCP tools

## Troubleshooting

### Issue: MCP Gateway connection failed

**Symptoms:**
```
‚ùå Error during agent execution: Connection refused
```

**Solutions:**
1. Check that MCP Gateway service is running: `docker compose ps`
2. Verify network connectivity: `docker compose logs mcp-gateway`
3. Ensure correct MCP_SERVER_URL: `http://mcp-gateway:8811/sse`

### Issue: No tools discovered

**Symptoms:**
```
üìã Found 0 MCP tools
```

**Solutions:**
1. Check MCP Gateway configuration in compose.yaml
2. Verify `--servers=duckduckgo` parameter
3. Check MCP Gateway logs: `docker compose logs mcp-gateway`

### Issue: Search tool not working

**Symptoms:**
- Agent runs but doesn't use search tool
- Generic responses without research

**Solutions:**
1. Verify `--tools=search` parameter in MCP Gateway configuration
2. Check internet connectivity from container
3. Review agent system prompt for search instructions

## Understanding What Happened

In this exercise, you:

1. **Set up MCP Gateway** - A secure proxy for external tool access
2. **Connected an agent** - Used Strands SDK to connect to MCP Gateway
3. **Discovered tools** - Dynamically found available external tools
4. **Used external tools** - Agent performed web searches through MCP Gateway
5. **Combined tools** - Mixed MCP tools with custom local tools

## Key Concepts Learned

- **MCP Gateway Architecture**: How it provides secure external tool access
- **Tool Discovery**: Dynamic discovery of available tools from MCP servers
- **Service Dependencies**: Proper Docker Compose service ordering
- **Error Handling**: Robust patterns for MCP connectivity issues

## Next Steps

In Exercise 2, you'll learn how to securely manage API keys using Docker secrets, enabling access to more powerful external services while maintaining security best practices.

---

**Exercise Complete!** üéâ

You've successfully set up MCP Gateway and created an agent with external tool capabilities. The agent can now research topics using web search and save the results locally.